// src/hooks/use-hover.tsx
import { useLayoutEffect } from "react";
import { useRefState } from "../utils/react.js";
function useHover(ref, options = {}) {
  const counter = useRefState(0);
  useLayoutEffect(() => {
    const el = ref.current;
    if (!el) return;
    let incr = 0;
    let prevInside = false;
    const contains = (r, x, y) => x >= r.left && x <= r.right && y >= r.top && y <= r.bottom;
    const enter = () => {
      incr++;
      counter.set((c) => c + 1);
      if (counter.current === 1) {
        options.onMouseEnter?.();
      }
    };
    const leave = () => {
      incr--;
      requestAnimationFrame(() => {
        requestAnimationFrame(() => {
          counter.set((c) => c - 1);
          if (counter.current === 0) {
            options.onMouseLeave?.();
          }
        });
      });
    };
    const topMatchesTarget = (x, y) => {
      const top = document.elementFromPoint(x, y);
      return !!(top && (top === el || el.contains(top)));
    };
    const processPoint = (x, y) => {
      const rect = el.getBoundingClientRect();
      const inside = contains(rect, x, y) && topMatchesTarget(x, y);
      if (inside && !prevInside) {
        enter();
      } else if (!inside && prevInside) {
        leave();
      }
      prevInside = inside;
    };
    const onMove = (e) => {
      if (e.pointerType !== "mouse") return;
      const batch = e.getCoalescedEvents();
      if (batch.length) {
        for (let eventIndex = 0; eventIndex < batch.length - 1; eventIndex++) {
          const e1 = batch[eventIndex];
          const e2 = batch[eventIndex + 1];
          const steps = 10;
          for (let i = 0; i <= steps; i++) {
            processPoint(e1.clientX + (e2.clientX - e1.clientX) * i / steps, e1.clientY + (e2.clientY - e1.clientY) * i / steps);
          }
        }
      } else {
        processPoint(e.clientX, e.clientY);
      }
    };
    window.addEventListener("pointermove", onMove, { passive: true });
    return () => {
      window.removeEventListener("pointermove", onMove);
      counter.set((c) => c - incr);
    };
  }, []);
  return counter.current > 0;
}
export {
  useHover
};
//# sourceMappingURL=use-hover.js.map